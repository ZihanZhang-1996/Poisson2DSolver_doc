
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Zihan Zhang">
      
      
      
      
      
      <link rel="icon" href="../../assets/logo2.jpg">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>GIWAXS reverse problem - 二维非线性柏松方程-ZZ</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-9XN0RGHSE1"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-9XN0RGHSE1",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-9XN0RGHSE1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#giwaxs-reverse-problem" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="二维非线性柏松方程-ZZ" class="md-header__button md-logo" aria-label="二维非线性柏松方程-ZZ" data-md-component="logo">
      
  <img src="../../assets/logo2.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            二维非线性柏松方程-ZZ
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GIWAXS reverse problem
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../OFD/ofd_note/" class="md-tabs__link">
        
  
    
  
  数学推导

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../input/" class="md-tabs__link">
        
  
    
  
  输入文件

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../Q1/" class="md-tabs__link">
        
  
    
  
  解析解和数值解的比较

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../Q2/" class="md-tabs__link">
        
  
    
  
  稀疏和稠密矩阵的比较

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../ctest/" class="md-tabs__link">
        
  
    
  
  单元测试

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../graph/" class="md-tabs__link">
        
  
    
  
  程序流程图

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../install/" class="md-tabs__link">
        
  
    
  
  安装说明

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="二维非线性柏松方程-ZZ" class="md-nav__button md-logo" aria-label="二维非线性柏松方程-ZZ" data-md-component="logo">
      
  <img src="../../assets/logo2.jpg" alt="logo">

    </a>
    二维非线性柏松方程-ZZ
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OFD/ofd_note/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数学推导
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../input/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    输入文件
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Q1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    解析解和数值解的比较
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Q2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    稀疏和稠密矩阵的比较
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ctest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    单元测试
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    程序流程图
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    安装说明
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#blue-print-of-the-program" class="md-nav__link">
    <span class="md-ellipsis">
      Blue print of the program
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
  
                  


<h1 id="giwaxs-reverse-problem">GIWAXS reverse problem<a class="headerlink" href="#giwaxs-reverse-problem" title="Permanent link">¶</a></h1>
<p>Zihan Zhang (<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#122;&#105;&#104;&#97;&#110;&#46;&#122;&#104;&#97;&#110;&#103;&#45;&#49;&#64;&#99;&#111;&#108;&#111;&#114;&#97;&#100;&#111;&#46;&#101;&#100;&#117;">&#122;&#105;&#104;&#97;&#110;&#46;&#122;&#104;&#97;&#110;&#103;&#45;&#49;&#64;&#99;&#111;&#108;&#111;&#114;&#97;&#100;&#111;&#46;&#101;&#100;&#117;</a>)</p>
<p>Reversed GIWAXS problem: derive the lattice parameters from the given GIWAXS pattern. </p>
<p>A brute-force search program </p>
<h2 id="blue-print-of-the-program">Blue print of the program<a class="headerlink" href="#blue-print-of-the-program" title="Permanent link">¶</a></h2>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled/> GIWAXS reverse problem<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled checked/> Input<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled checked/> Given peak positions (In the first quadrant only)</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> A guess of <span class="arithmatex">\(\vec{G}\)</span></li>
</ul>
</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> DOF analysis<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled checked/> Original 9 degrees of freedom </li>
<li class="task-list-item"><input type="checkbox" disabled checked/> [<span class="arithmatex">\(a^*_x\)</span>,<span class="arithmatex">\(a^*_y\)</span>,<span class="arithmatex">\(a^*_z\)</span>] [<span class="arithmatex">\(b^*_x\)</span>,<span class="arithmatex">\(b^*_y\)</span>,<span class="arithmatex">\(b^*_z\)</span>] [<span class="arithmatex">\(c^*_x\)</span>,<span class="arithmatex">\(c^*_y\)</span>,<span class="arithmatex">\(c^*_z\)</span>]</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> Force <span class="arithmatex">\(\vec{a}^*\)</span> to be in [<span class="arithmatex">\(a_x^*\)</span>,0,<span class="arithmatex">\(a_z^*\)</span>] direction (kills 1 degrees of freedom (DOF=8))</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> Find the peak that is nearest to [0,0,0] (gives <span class="arithmatex">\(a_x^*\)</span> and <span class="arithmatex">\(a_z^*\)</span>, (DOF=6))</li>
<li class="task-list-item"><input type="checkbox" disabled/> Remove peaks <span class="arithmatex">\(\vec{a}^*\)</span>, <span class="arithmatex">\(2\vec{a}^*\)</span>, <span class="arithmatex">\(3\vec{a}^*\)</span>, ...</li>
<li class="task-list-item"><input type="checkbox" disabled/> Find the next nearest peak (gives [<span class="arithmatex">\(b_{xy}^*\)</span>,<span class="arithmatex">\(b_z^*\)</span>] and kills 2 DOF (DOF=4))</li>
</ul>
</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> Algorithm<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled checked/> Monte Carlo (good for high dimensions), Markov chain (Brute-force search. This is a ill-conditioned problem with a lot of local minimums.)</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> Cost function: add up the distance of each given peak to the nearest simulated peak. add up the distance of each simulated peak to the nearest given peak. (make sure every peak find their friend)</li>
</ul>
</li>
<li class="task-list-item"><input type="checkbox" disabled/> Optimization<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled/> use gradient decent after MT to boost the convergence</li>
<li class="task-list-item"><input type="checkbox" disabled/> convert the output lattice parameter to a high symmetry format</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Import libraries</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Code</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage</span> <span class="k">as</span> <span class="nn">ndimage</span>
<span class="kn">import</span> <span class="nn">diffraction</span> <span class="k">as</span> <span class="nn">diff</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">time</span> <span class="k">as</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="kn">import</span> <span class="n">Button</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="kn">import</span> <span class="n">RangeSlider</span>
<span class="kn">import</span> <span class="nn">matplotlib.patheffects</span> <span class="k">as</span> <span class="nn">path_effects</span>
</code></pre></div>
</div>
</div>
</div>
<p>Input</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Code</label><label for="__tabbed_2_2">Functions</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">qxy_exp</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="n">qz_exp</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="n">Bragg_peaks_exp</span><span class="o">=</span><span class="p">[</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2.818</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2.818</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2.818</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2.818</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.414</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.414</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.414</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">3.16</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">3.16</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">3.16</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">4.24</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">4.24</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">4.24</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">hkl</span><span class="o">=</span><span class="mi">5</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">make_cif</span><span class="p">(</span><span class="n">Bragg_peaks</span><span class="p">):</span>
    <span class="c1"># b1=[np.random.uniform(-ub, ub),0,np.random.uniform(-ub, ub)]</span>
    <span class="n">b2x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
    <span class="n">b3x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">b3y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">b3z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">b1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">b2</span><span class="o">=</span><span class="p">[</span><span class="n">b2x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.25</span><span class="o">-</span><span class="n">b2x</span><span class="o">*</span><span class="n">b2x</span><span class="p">),</span><span class="mf">0.5</span><span class="p">]</span>
    <span class="n">b3</span><span class="o">=</span><span class="p">[</span><span class="n">b3x</span><span class="p">,</span><span class="n">b3y</span><span class="p">,</span><span class="n">b3z</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">,</span><span class="n">b3</span>

<span class="k">def</span> <span class="nf">find_c</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="n">x_values_with_leading_zero</span> <span class="o">=</span> <span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">array</span> <span class="k">if</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">x_values_with_leading_zero</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">x_values_with_leading_zero</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">closest_distance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
    <span class="c1"># Convert the input to numpy arrays if they aren&#39;t already</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

    <span class="c1"># Compute squared distances</span>
    <span class="n">squared_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">array</span> <span class="o">-</span> <span class="n">point</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Find the minimum squared distance and take its square root to get the actual distance</span>
    <span class="n">min_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">squared_distances</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">min_distance</span>

<span class="k">def</span> <span class="nf">Bragg_peaks</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">,</span><span class="n">b3</span><span class="p">,</span><span class="n">hkl_dimension</span><span class="p">):</span>
    <span class="c1"># grid for Miller index</span>
    <span class="n">i</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">hkl_dimension</span><span class="p">,</span><span class="n">hkl_dimension</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">hkl_dimension</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">H</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="n">L</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># The position of Bragg peaks in reciprocal space</span>
    <span class="n">G1</span><span class="o">=</span><span class="n">H</span><span class="o">*</span><span class="n">b1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">K</span><span class="o">*</span><span class="n">b2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">L</span><span class="o">*</span><span class="n">b3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">G2</span><span class="o">=</span><span class="n">H</span><span class="o">*</span><span class="n">b1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">K</span><span class="o">*</span><span class="n">b2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">L</span><span class="o">*</span><span class="n">b3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">G3</span><span class="o">=</span><span class="n">H</span><span class="o">*</span><span class="n">b1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">K</span><span class="o">*</span><span class="n">b2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">L</span><span class="o">*</span><span class="n">b3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">q2</span><span class="o">=</span><span class="n">G1</span><span class="o">*</span><span class="n">G1</span><span class="o">+</span><span class="n">G2</span><span class="o">*</span><span class="n">G2</span><span class="o">+</span><span class="n">G3</span><span class="o">*</span><span class="n">G3</span>
    <span class="n">F</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">Bpeaks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">G1</span><span class="p">,</span><span class="n">G2</span><span class="p">,</span><span class="n">G3</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># return Bpeaks,pow(G1*G1+G2*G2,0.5),pow(G3*G3,0.5)</span>
    <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">G1</span><span class="o">*</span><span class="n">G1</span><span class="o">+</span><span class="n">G2</span><span class="o">*</span><span class="n">G2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span><span class="nb">pow</span><span class="p">(</span><span class="n">G3</span><span class="o">*</span><span class="n">G3</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">FT</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">):</span>
    <span class="c1"># Lattice parameters M matrix in cartesian coordinate(angstrom)</span>
    <span class="n">M</span><span class="o">=</span><span class="p">[</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">]</span>
    <span class="n">M</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>

    <span class="c1"># New lattice parameter</span>
    <span class="n">aa1</span><span class="o">=</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
    <span class="n">aa2</span><span class="o">=</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>
    <span class="n">aa3</span><span class="o">=</span><span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span>

    <span class="c1"># reciprocal lattice</span>
    <span class="n">volume</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">aa3</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">aa1</span><span class="p">,</span><span class="n">aa2</span><span class="p">))</span>
    <span class="n">b1</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">aa2</span><span class="p">,</span><span class="n">aa3</span><span class="p">)</span><span class="o">/</span><span class="n">volume</span>
    <span class="n">b2</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">aa3</span><span class="p">,</span><span class="n">aa1</span><span class="p">)</span><span class="o">/</span><span class="n">volume</span>
    <span class="n">b3</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">aa1</span><span class="p">,</span><span class="n">aa2</span><span class="p">)</span><span class="o">/</span><span class="n">volume</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">,</span><span class="n">b3</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
</div>
<p>Main </p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Code</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">total_distance0</span><span class="o">=</span><span class="mi">99999999</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500000</span><span class="p">):</span>
    <span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">,</span><span class="n">b3</span><span class="o">=</span><span class="n">make_cif</span><span class="p">(</span><span class="n">Bragg_peaks_exp</span><span class="p">)</span>
    <span class="n">qxy</span><span class="p">,</span><span class="n">qz</span><span class="o">=</span><span class="n">Bragg_peaks</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">,</span><span class="n">b3</span><span class="p">,</span><span class="n">hkl</span><span class="p">)</span>
    <span class="n">qxy</span><span class="o">=</span><span class="n">qxy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">qz</span><span class="o">=</span><span class="n">qz</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">combined</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">qxy</span><span class="p">,</span> <span class="n">qz</span><span class="p">))</span>
    <span class="n">j</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">total_distance</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">Bragg_peaks_exp</span><span class="p">:</span>
        <span class="n">total_distance</span><span class="o">=</span><span class="n">total_distance</span><span class="o">+</span><span class="n">closest_distance</span><span class="p">(</span><span class="n">combined</span><span class="p">,</span><span class="n">Bragg_peaks_exp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">j1</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">combined</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">combined</span><span class="p">[</span><span class="n">j1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">qxy_exp</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">combined</span><span class="p">[</span><span class="n">j1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">qz_exp</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">total_distance</span><span class="o">=</span><span class="n">total_distance</span><span class="o">+</span><span class="n">closest_distance</span><span class="p">(</span><span class="n">Bragg_peaks_exp</span><span class="p">,</span><span class="n">combined</span><span class="p">[</span><span class="n">j1</span><span class="p">])</span>
        <span class="n">j1</span><span class="o">=</span><span class="n">j1</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">total_distance</span><span class="o">&lt;</span><span class="n">total_distance0</span><span class="p">:</span>
        <span class="n">total_distance0</span><span class="o">=</span><span class="n">total_distance</span>
        <span class="n">FT</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">,</span><span class="n">b3</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
</div>
<p>Performance:</p>
<p>The result from a test on PC. (~ 25 miniutes cpu time)</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Lattice parameter</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="p">[</span> <span class="mf">1.09233506</span> <span class="o">-</span><span class="mf">2.95321592</span>  <span class="mf">6.28318531</span><span class="p">]</span> 
<span class="p">[</span><span class="o">-</span><span class="mf">2.18850426</span>  <span class="mf">5.89804628</span>  <span class="mf">0.</span>        <span class="p">]</span> 
<span class="p">[</span><span class="o">-</span><span class="mf">1.84097256</span> <span class="o">-</span><span class="mf">4.0263532</span>   <span class="mf">0.</span>        <span class="p">]</span>

<span class="c1">## rotate this lattice and re-define lattice parameters to make it symmetric, you&#39;ll get</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">pi</span><span class="p">,</span><span class="o">-</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="n">pi</span><span class="p">]</span>
</code></pre></div>
</div>
</div>
</div>
<figure>
  <img src="../assets/GIWAXS_reverse2.png" width=600px;>
  <figcaption>Fig 1. (a) The reverse problem (b) Simulation using the lattice parameter found by the program.</figcaption>
</figure>









  




                

  

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.tabs"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>